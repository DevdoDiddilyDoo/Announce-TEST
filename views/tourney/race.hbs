<div class="container" data-race-id="{{race._id}}" id="raceContainer">
	<h1>Tourney Race Management</h1>
	{{#with race}}
		<div class="card" style="width: 18rem;" id="raceHeader">
		  <div class="card-body">
		    <h5 class="card-title">{{{decorateRacers match1.players}}} {{{decorateRacers match2.players}}}</h5>
		    <h6 class="card-subtitle mb-2 text-muted">{{localize when}}</h6>
		    <p class="card-text"><i class="fas fa-microphone"></i>&nbsp;{{{parseCommentary commentators}}}</p>
		    <p>{{{restreamStatus channel}}}</p>
		  </div>
		</div>

		<div id="raceActions" style="margin-top: 10px">
			{{#if srtvRace}}
				<a href="{{srtvUrl srtvRace.guid}}" target="_blank" class="btn btn-secondary">
					<i class="fas fa-external-link-alt"></i>&nbsp;Go To Race Channel
				</a>
				<button class="btn btn-secondary" id="btnPingParticipants"{{#unless srtvRace}} disabled{{/unless}}>
					<i class="fas fa-bell"></i>&nbsp;Ping Participants
				</button>
				<button class="btn btn-secondary" id="btnSendRaceAnnouncements"{{#unless srtvRace}} disabled{{/unless}}>
					<i class="fas fa-bullhorn"></i>&nbsp;Race Announcements
				</button>
				<button class="btn btn-secondary" id="btnGenerateFilenames"{{#unless srtvRace}} disabled{{/unless}}>
					<i class="fas fa-file"></i>&nbsp;Generate Filenames
				</button>
				<a href="https://challonge.com/ALTTP2018/report_scores" target="_blank" class="btn btn-secondary">
					<i class="fas fa-clipboard-check"></i>&nbsp;Report Results
				</a>
			{{else}}
				<button class="btn btn-secondary" id="btnCreateRaceChannel" data-toggle="modal" data-target="#createRaceChannelConfirmation">
					<i class="fas fa-plus"></i>&nbsp;Create Race Channel
				</button>
			{{/if}}
		</div>
	{{/with}}
</div>

{{> modal id="createRaceChannelConfirmation" title="Confirmation" body="Are you sure you want to create this race?" affirmativeText="Yes, Create It!"}}

<script>
	$(document).ready(() => {
		var raceId = $('#raceContainer').data('race-id');

		$('#btncreateRaceChannelConfirmationAffirmative').on('click', (e) => {
			let btn = $(this);
			btn.attr('disabled', 'disabled');

			// make call to server to create the race
			$.ajax({
				type: "POST",
				url: "/tourney/races",
				data: {id: raceId},
				dataType: "json"
			})
			.done((data, textStatus, jqXHR) => {
				alert('Race created!');
				location.reload();
			})
			.fail((jqXHR, textStatus) => {
				alert('Request failed: ' + textStatus);
				location.reload();
			})
			.always(() => {
				btn.removeAttr('disabled');
			});
		});
	});
</script>